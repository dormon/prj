#include"catch.hpp"

#include "morton.h"

TEST_CASE("bitTests")
{
  REQUIRE(REQUIRED_BITS(1) == 0);
  REQUIRE(REQUIRED_BITS(2) == 1);
  REQUIRE(REQUIRED_BITS(3) == 2);

  REQUIRE(WARP_BITS(32) == 5);
  REQUIRE(WARP_BITS(64) == 6);
  REQUIRE(WARP_BITS_X(32) == 3);
  REQUIRE(WARP_BITS_Y(32) == 2);
  REQUIRE(WARP_BITS_X(64) == 3);
  REQUIRE(WARP_BITS_Y(64) == 3);
  REQUIRE(WARP_X(32) ==  8);
  REQUIRE(WARP_Y(32) ==  4);
  REQUIRE(WARP_X(64) ==  8);
  REQUIRE(WARP_Y(64) ==  8);

  REQUIRE(UINTS_PER_WARP(32) == 1);
  REQUIRE(UINTS_PER_WARP(64) == 2);

  REQUIRE(CLUSTERS_X(32,513) == 65 );
  REQUIRE(CLUSTERS_X(32,512) == 64 );
  REQUIRE(CLUSTERS_X(32,511) == 64 );
  REQUIRE(CLUSTERS_X(32,504) == 63 );
  REQUIRE(CLUSTERS_X(32,8)   == 1  );
  REQUIRE(CLUSTERS_Y(32,513) == 129);
  REQUIRE(CLUSTERS_Y(32,512) == 128);
  REQUIRE(CLUSTERS_Y(32,511) == 128);
  REQUIRE(CLUSTERS_Y(32,504) == 126);
  REQUIRE(CLUSTERS_Y(32,4)   == 1  );

  REQUIRE(CLUSTERS_X(64,513) == 65);
  REQUIRE(CLUSTERS_X(64,512) == 64);
  REQUIRE(CLUSTERS_X(64,511) == 64);
  REQUIRE(CLUSTERS_X(64,504) == 63);
  REQUIRE(CLUSTERS_X(64,8  ) == 1 );
  REQUIRE(CLUSTERS_Y(64,513) == 65);
  REQUIRE(CLUSTERS_Y(64,512) == 64);
  REQUIRE(CLUSTERS_Y(64,511) == 64);
  REQUIRE(CLUSTERS_Y(64,504) == 63);
  REQUIRE(CLUSTERS_Y(64,8  ) == 1 );

  REQUIRE(X_BITS(32,513) == 7);
  REQUIRE(X_BITS(32,512) == 6);
  REQUIRE(X_BITS(32,511) == 6);
  REQUIRE(X_BITS(32,504) == 6);
  REQUIRE(X_BITS(32,257) == 6);
  REQUIRE(X_BITS(32,256) == 5);
  REQUIRE(X_BITS(32,255) == 5);
  REQUIRE(X_BITS(32,8)   == 0);

  REQUIRE(X_BITS(64,513) == 7);
  REQUIRE(X_BITS(64,512) == 6);
  REQUIRE(X_BITS(64,511) == 6);
  REQUIRE(X_BITS(64,504) == 6);
  REQUIRE(X_BITS(64,257) == 6);
  REQUIRE(X_BITS(64,256) == 5);
  REQUIRE(X_BITS(64,255) == 5);

  REQUIRE(Y_BITS(32,513) == 8);
  REQUIRE(Y_BITS(32,512) == 7);
  REQUIRE(Y_BITS(32,511) == 7);
  REQUIRE(Y_BITS(32,504) == 7);
  REQUIRE(Y_BITS(32,257) == 7);
  REQUIRE(Y_BITS(32,256) == 6);
  REQUIRE(Y_BITS(32,255) == 6);

  REQUIRE(Y_BITS(64,513) == 7);
  REQUIRE(Y_BITS(64,512) == 6);
  REQUIRE(Y_BITS(64,511) == 6);
  REQUIRE(Y_BITS(64,504) == 6);
  REQUIRE(Y_BITS(64,257) == 6);
  REQUIRE(Y_BITS(64,256) == 5);
  REQUIRE(Y_BITS(64,255) == 5);

  REQUIRE(Z_BITS(32,512,512,2) == 7);
  REQUIRE(Z_BITS(32,512,512,8) == 8);
  REQUIRE(Z_BITS(32,512,256,2) == 6);
  REQUIRE(Z_BITS(32,512,256,7) == 7);

  REQUIRE(Z_BITS(64,512,512,2) == 6);
  REQUIRE(Z_BITS(64,512,512,8) == 8);
  REQUIRE(Z_BITS(64,512,256,2) == 6);
  REQUIRE(Z_BITS(64,512,256,7) == 7);

  REQUIRE(CLUSTERS_Z(32,512,512,9) == (1u<<9u));
  REQUIRE(CLUSTERS_Z(32,512,512,2) == (1u<<7u));
  REQUIRE(CLUSTERS_Z(32,512,256,2) == (1u<<6u));

  REQUIRE(CLUSTERS_Z(64,512,512,9) == (1u<<9u));
  REQUIRE(CLUSTERS_Z(64,512,512,2) == (1u<<6u));
  REQUIRE(CLUSTERS_Z(64,512,256,2) == (1u<<6u));

  REQUIRE(ALL_BITS(32,512,512,2) == 6+7+7);
  REQUIRE(ALL_BITS(32,512,512,9) == 6+7+9);
  REQUIRE(ALL_BITS(64,512,512,2) == 6+6+6);
  REQUIRE(ALL_BITS(64,512,512,9) == 6+6+9);
}
